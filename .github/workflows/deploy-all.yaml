name: Deploy All
run-name: ${{ github.actor }} deploys via GitHub Actions

on:
  workflow_dispatch

jobs:
  build-all:
    runs-on: ubuntu-latest
    name: Build All

    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v3

      - run: mkdir -v _site
      - run: |
          mkdir -v \
          _r__-for-a-comment \
          cru_-for-an-application \
          crud-for-a-x \
          just-a-card \
          just-a-form \
          x \
          # yandex-disk
        working-directory: _site

# _R__ for a Comment
      - run: npm ci
        working-directory: _r__-for-a-comment
      - name: Build “_R__ for a Comment”
        run: npm run build
        working-directory: _r__-for-a-comment

# CRUD for a X
      - run: npm ci
        working-directory: cru_-for-a-x
      - run: npm run build:release
        working-directory: cru_-for-a-x

# CRU_ for an Application
      - run: npm ci
        working-directory: cru_-for-an-application
      - name: Buid
        run: npm run build:release
        working-directory: cru_-for-an-application

# Just a Card
      - run: npm ci
        working-directory: just-a-card/
      - name: Build “Just a Card”
        run: npm run build
        working-directory: just-a-card/

# Just a Form
      - run: npm ci
        working-directory: cru_-for-an-application
      - run: npm run build:release
        working-directory: cru_-for-an-application

# X
      - run: npm ci
        working-directory: Next.js/x
      - name: Build “X”
        run: npm run build
        working-directory: Next.js/x

      - run: mv cru_-for-an-application/.build/* _site/cru_-for-an-application
      - run: mv Card/dist/* _site/just-a-card/
      - run: mv Next.js/proportional/out/* _site/x
      - run: mv Message\ Fetcher/build/* _site/_r__-for-a-comment/

      - uses: actions/upload-pages-artifact@v2

  #test-all:
    #runs-on: ubuntu-latest
    #steps:

  deploy-all:
    runs-on: ubuntu-latest
    needs: build-all
    name: Deploy All

    permissions:
      id-token: write
      pages: write

    steps:
      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v2
